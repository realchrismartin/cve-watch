import React from 'react';
import './App.css';

class App extends React.Component<{},{data:Object[],user:string,repo:string}> {

  constructor(props : any) {
    super(props);
    this.state = {data:[],user:"",repo:""}
  }
  
  handleSearch = (e: any) => {
    fetch("http://localhost/test/" + this.state.user + "/" + this.state.repo).then((res) => {
      return res.json()
    }).then((res) => {
      this.setState({data:res})
    });
  }
  handleUserChange = (e: any) => {
    this.setState({user:e.target.value})
  }

  handleRepoChange = (e: any) => {
    this.setState({repo:e.target.value})
  }

 render() : any {

  let files = this.state.data.map((it : any) => { 
    let res : any[] = [];
    res.push(<div className="file">{it.path}</div>)
    
    let dependencies = it.dependencies;

    for(let dep in dependencies) {
      res.push(<div className="dep">{dependencies[dep]}</div>);
    }
    return res;
  });

   return (
   <div> 
     <button onClick={this.handleSearch}>Search</button> 
     <input type="text" id="user" onChange={this.handleUserChange}></input>
     <input type="text" id="repo" onChange={this.handleRepoChange}></input>
     <div>
       {files}
     </div>
   </div>
   )
 } 
}

export default App;
