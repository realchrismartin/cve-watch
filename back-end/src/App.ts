import express from 'express';
import IRouter from './router/IRouter';
import AccountRouter from './router/AccountRouter';
import VulnerabilityRouter from './router/VulnerabilityRouter';
import SoftwareRouter from './router/SoftwareRouter';
const cors = require("cors");

class App {

    app : express.Application;
    server : any;
    port : number;
    routers : IRouter[]

    constructor() { 
        this.app = express();
        if(process.env.PORT != undefined) {
            this.port = parseInt(process.env.PORT);
        } else {
            this.port = 80;
        }
        this.routers = [];
    }

    async run() {
        return new Promise((resolve,reject) => {

            //TODO: Add database connection
            this.server = this.app.listen(this.port,() => {

                //TODO: Add more routers
                this.routers.push(new AccountRouter(this.app,"/accounts"));
                this.routers.push(new VulnerabilityRouter(this.app,"/vulnerabilities"));
                this.routers.push(new SoftwareRouter(this.app,"/software"));

                console.log("Server online");

                this.server.on("close",() => {
                    console.log("Shutting down.")
                });

                resolve(undefined);
            });
        });
    }
}

export default App;