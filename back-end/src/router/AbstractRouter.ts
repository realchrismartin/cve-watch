import express, { Router } from "express";
import IRouter from "./IRouter";
import session from "express-session";
const cors = require("cors");

class AbstractRouter implements IRouter {
  router: Router;

  constructor(app: express.Application, route: string) {
    this.router = express.Router();

    let sessionConfig = {
      name: "cve-app-user-session",
      secret: "TODOREPLACEME", //TODO: Replace and put in env
      cookie:{},
      saveUninitialized: false,
      resave: false,
    };

    let isProduction = true; //TODO: Put in env

    sessionConfig.cookie =  { maxAge: 999999, secure:isProduction, sameSite:"none" }

    app.set('trust proxy', 1) // trust first proxy
    //Configure CORS
    app.use(cors({
        origin: ["http://localhost:3000","http://localhost","https://p3-front.herokuapp.com"],
        credentials: true,
        exposedHeaders: ['set-cookie']
    }));

    app.use(session(sessionConfig));
    app.use(express.json());
    app.use(route, this.router);
  }
}

export default AbstractRouter;
